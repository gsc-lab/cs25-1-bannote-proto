syntax = "proto3";

package bannote.studyroomservice.reservation.v1;

import "google/protobuf/timestamp.proto";

// ===============================================
// 예약 우선순위
// ===============================================
enum ReservationPriority {
  RESERVATION_PRIORITY_UNSPECIFIED = 0;
  RESERVATION_PRIORITY_LOW = 1;
  RESERVATION_PRIORITY_MEDIUM = 2;
  RESERVATION_PRIORITY_HIGH = 3;
}

// ===============================================
// 예약 상태
// ===============================================
enum ReservationStatus {
  RESERVATION_STATUS_UNSPECIFIED = 0;
  RESERVATION_STATUS_CONFIRMED = 1;
  RESERVATION_STATUS_CANCELED = 2;
  RESERVATION_STATUS_COMPLETED = 3;
  RESERVATION_STATUS_CANCELED_BY_OTHER = 4;
}

// ===============================================
// User 정보 (유저 서비스 연동용)
// ===============================================
message User {
  int64 user_code = 1;
  string name = 2;
  string department = 3;
}

// ===============================================
// 예약 정보
// ===============================================
message Reservation {
  int64 id = 1;
  string code = 2;
  int64 room_id = 3;

  // string datetime
  string start_time = 4;
  string end_time = 5;

  string purpose = 6;
  ReservationPriority priority = 7;
  ReservationStatus status = 8;

  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
  google.protobuf.Timestamp deleted_at = 11;

  repeated int64 user_codes = 12;
  repeated User users = 13;     // ← 추가됨
}

// ===============================================
// 1. 예약 생성
// ===============================================
message CreateReservationRequest {
  int64 room_id = 1;
  string start_time = 2;
  string end_time = 3;
  string purpose = 4;
  ReservationPriority priority = 5;
  repeated int64 user_codes = 6;
}

message CreateReservationResponse {
  Reservation reservation = 1;
}

// ===============================================
// 2. 예약 단건 조회
// ===============================================
message GetReservationRequest {
  string code = 1;
}

message GetReservationResponse {
  Reservation reservation = 1;
}

// ===============================================
// 3. 예약 목록 조회 (여러 방 ID + 시간 범위)
// ===============================================
message ListReservationsRequest {
  repeated int64 room_ids = 1;
  string start_time_after = 2;
  string end_time_before = 3;
}

message ListReservationsResponse {
  repeated Reservation reservations = 1;
}

// ===============================================
// 4. 예약 수정
// ===============================================
message UpdateReservationRequest {
  string code = 1;
  int64 room_id = 2;
  string start_time = 3;
  string end_time = 4;
  string purpose = 5;
  ReservationPriority priority = 6;
  repeated int64 user_codes = 7;
}

message UpdateReservationResponse {
  Reservation reservation = 1;
}

// ===============================================
// 5. 예약 삭제
// ===============================================
message DeleteReservationRequest {
  string code = 1;
}

message DeleteReservationResponse {
  bool success = 1;
  string message = 2;
}
